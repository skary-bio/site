<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blend Cubes ğŸ²</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    canvas {
      border: 3px solid #ff3399;
      background: #111;
    }
    .neon-text {
      text-shadow: 0 0 5px #ff3399, 0 0 10px #33ffcc;
    }
    .pulse:hover {
      animation: pulse 0.3s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center">
  <!-- ğŸ“‹ Ğ­ĞºÑ€Ğ°Ğ½ Ğ²Ğ²Ğ¾Ğ´Ğ° Ğ½Ğ¸ĞºĞ° -->
  <div id="loginScreen" class="text-center">
    <h1 class="text-5xl neon-text my-4">Blend Cubes ğŸ²</h1>
    <input id="nickname" type="text" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸ ÑĞ²Ğ¾Ğ¹ Ğ½Ğ¸Ğº ğŸ˜" class="p-2 rounded bg-gray-800 text-white border border-pink-500">
    <button id="joinBtn" class="bg-pink-500 hover:bg-pink-700 pulse text-white font-bold py-2 px-4 rounded mt-4">Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ ğŸšª</button>
    <p id="error" class="text-red-500 hidden">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ğŸ˜¢</p>
  </div>

  <!-- ğŸ® Ğ­ĞºÑ€Ğ°Ğ½ Ğ»Ğ¾Ğ±Ğ±Ğ¸ -->
  <div id="lobbyScreen" class="hidden text-center">
    <h1 class="text-5xl neon-text my-4">Ğ›Ğ¾Ğ±Ğ±Ğ¸ ğŸ•’</h1>
    <p>ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²... ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 3 ğŸ‘¥</p>
    <p id="playerCount">Ğ˜Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²: 0</p>
    <p id="countdown" class="text-2xl neon-text"></p>
    <canvas id="lobbyCanvas" width="800" height="600"></canvas>
  </div>

  <!-- ğŸƒ Ğ­ĞºÑ€Ğ°Ğ½ Ğ¸Ğ³Ñ€Ñ‹ -->
  <div id="gameScreen" class="hidden text-center">
    <h1 class="text-5xl neon-text my-4">Blend Cubes ğŸ²</h1>
    <p>Ğ–Ğ¸Ğ²Ñ‹Ñ… Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²: <span id="aliveCount">0</span> ğŸ‘¥</p>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
  </div>

  <script>
    // ğŸ¨ Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ DOM
    const loginScreen = document.getElementById('loginScreen');
    const lobbyScreen = document.getElementById('lobbyScreen');
    const gameScreen = document.getElementById('gameScreen');
    const nicknameInput = document.getElementById('nickname');
    const joinBtn = document.getElementById('joinBtn');
    const errorDisplay = document.getElementById('error');
    const playerCount = document.getElementById('playerCount');
    const countdown = document.getElementById('countdown');
    const aliveCount = document.getElementById('aliveCount');
    const lobbyCanvas = document.getElementById('lobbyCanvas');
    const gameCanvas = document.getElementById('gameCanvas');
    const lobbyCtx = lobbyCanvas.getContext('2d');
    const gameCtx = gameCanvas.getContext('2d');

    // ğŸŒ Socket.IO (ÑƒĞºĞ°Ğ¶Ğ¸ ÑĞ²Ğ¾Ğ¹ Ğ´Ğ¾Ğ¼ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ localhost Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ°)
    const socket = io('YOUR_DOMAIN_OR_IP:8080', { 
      transports: ['websocket'],
      secure: true // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ true Ğ´Ğ»Ñ HTTPS/WSS
    });
    let playerId = null;
    let nickname = '';
    let players = {};
    let gameState = 'login';
    let keys = {};

    // ğŸšª Ğ’Ñ…Ğ¾Ğ´ Ğ² Ğ¸Ğ³Ñ€Ñƒ
    joinBtn.addEventListener('click', () => {
      nickname = nicknameInput.value.trim();
      if (nickname) {
        socket.emit('join', { nickname });
        loginScreen.classList.add('hidden');
        lobbyScreen.classList.remove('hidden');
        gameState = 'lobby';
      }
    });

    // ğŸ¹ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
    document.addEventListener('keydown', e => keys[e.key] = true);
    document.addEventListener('keyup', e => keys[e.key] = false);

    // ğŸ–±ï¸ ĞšĞ»Ğ¸Ğº Ğ¿Ğ¾ ĞºÑƒĞ±Ğ¸ĞºÑƒ
    gameCanvas.addEventListener('click', (e) => {
      if (gameState === 'game' && players[playerId]?.alive) {
        const rect = gameCanvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        for (const id in players) {
          if (id !== playerId && players[id].alive) {
            const dx = players[id].x - (x + (players[playerId].x - 400));
            const dy = players[id].y - (y + (players[playerId].y - 300));
            if (Math.hypot(dx, dy) < 20) {
              socket.emit('kill', { targetId: id });
              break;
            }
          }
        }
      }
    });

    // ğŸ“¡ ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¾Ñ‚ ÑĞµÑ€Ğ²ĞµÑ€Ğ°
    socket.on('init', (data) => {
      playerId = data.playerId;
    });

    socket.on('update', (data) => {
      players = data.players;
      if (gameState === 'lobby') {
        playerCount.textContent = `Ğ˜Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²: ${Object.keys(players).length}`;
        countdown.textContent = data.countdown ? `Ğ¡Ñ‚Ğ°Ñ€Ñ‚ Ñ‡ĞµÑ€ĞµĞ·: ${data.countdown} ÑĞµĞº ğŸ•’` : '';
      } else if (gameState === 'game') {
        aliveCount.textContent = Object.values(players).filter(p => p.alive).length;
      }
    });

    socket.on('start', () => {
      lobbyScreen.classList.add('hidden');
      gameScreen.classList.remove('hidden');
      gameState = 'game';
      updateGame();
    });

    socket.on('connect_error', (err) => {
      errorDisplay.textContent = `ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ğŸ˜¢ ${err.message}`;
      errorDisplay.classList.remove('hidden');
    });

    // ğŸ® ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ»Ğ¾Ğ±Ğ±Ğ¸
    function updateLobby() {
      lobbyCtx.clearRect(0, 0, lobbyCanvas.width, lobbyCanvas.height);
      // ğŸŒŸ ĞĞ½Ğ¸Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½
      lobbyCtx.fillStyle = '#111';
      lobbyCtx.fillRect(0, 0, lobbyCanvas.width, lobbyCanvas.height);
      for (let i = 0; i < 50; i++) {
        lobbyCtx.fillStyle = 'rgba(255, 255, 255, 0.5)';
        lobbyCtx.fillRect(Math.random() * 800, Math.random() * 600, 2, 2);
      }
      for (const id in players) {
        const p = players[id];
        lobbyCtx.fillStyle = p.alive ? '#ff3399' : '#555';
        lobbyCtx.fillRect(p.x, p.y, 20, 20);
        lobbyCtx.fillStyle = 'white';
        lobbyCtx.font = '14px Arial';
        lobbyCtx.fillText(p.nickname, p.x, p.y - 10);
      }
      if (gameState === 'lobby') requestAnimationFrame(updateLobby);
    }

    // ğŸƒ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ³Ñ€Ñ‹
    function updateGame() {
      gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);

      // ğŸ¥ ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ·Ñ€ĞµĞ½Ğ¸Ñ
      gameCtx.save();
      gameCtx.beginPath();
      gameCtx.arc(400, 300, 100, 0, Math.PI * 2);
      gameCtx.clip();

      // ğŸ—ºï¸ ĞÑ‚Ñ€Ğ¸ÑĞ¾Ğ²ĞºĞ° ĞºĞ°Ñ€Ñ‚Ñ‹
      gameCtx.fillStyle = '#222';
      gameCtx.fillRect(0, 0, 1000, 1000);

      // ğŸ² ĞÑ‚Ñ€Ğ¸ÑĞ¾Ğ²ĞºĞ° Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²
      const px = players[playerId]?.x || 400;
      const py = players[playerId]?.y || 300;
      for (const id in players) {
        const p = players[id];
        if (p.alive) {
          const drawX = p.x - (px - 400);
          const drawY = p.y - (py - 300);
          gameCtx.fillStyle = '#ff3399';
          gameCtx.fillRect(drawX - 10, drawY - 10, 20, 20);
          gameCtx.fillStyle = 'white';
          gameCtx.font = '14px Arial';
          gameCtx.fillText(p.nickname, drawX - 10, drawY - 20);
        }
      }

      gameCtx.restore();

      // ğŸš¶ Ğ”Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ
      if (gameState === 'game' && players[playerId]?.alive) {
        let dx = 0, dy = 0;
        if (keys.ArrowUp || keys.w) dy -= 5;
        if (keys.ArrowDown || keys.s) dy += 5;
        if (keys.ArrowLeft || keys.a) dx -= 5;
        if (keys.ArrowRight || keys.d) dx += 5;
        if (dx || dy) {
          socket.emit('move', { dx, dy });
        }
      }

      if (gameState === 'game') requestAnimationFrame(updateGame);
    }

    // ğŸš€ Ğ¡Ñ‚Ğ°Ñ€Ñ‚ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³Ğ°
    socket.on('connect', () => {
      updateLobby();
    });
  </script>
</body>
</html>
