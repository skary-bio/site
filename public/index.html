<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blend Cubes ðŸŽ²</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    canvas {
      border: 3px solid #ff3399;
      background: #111;
    }
    .neon-text {
      text-shadow: 0 0 5px #ff3399, 0 0 10px #33ffcc;
    }
    .pulse:hover {
      animation: pulse 0.3s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center">
  <!-- ðŸ“‹ Ð­ÐºÑ€Ð°Ð½ Ð²Ð²Ð¾Ð´Ð° Ð½Ð¸ÐºÐ° -->
  <div id="loginScreen" class="text-center">
    <h1 class="text-5xl neon-text my-4">Blend Cubes ðŸŽ²</h1>
    <input id="nickname" type="text" placeholder="Ð’Ð²ÐµÐ´Ð¸ ÑÐ²Ð¾Ð¹ Ð½Ð¸Ðº ðŸ˜Ž" class="p-2 rounded bg-gray-800 text-white border border-pink-500">
    <button id="joinBtn" class="bg-pink-500 hover:bg-pink-700 pulse text-white font-bold py-2 px-4 rounded mt-4">Ð’Ð¾Ð¹Ñ‚Ð¸ ðŸšª</button>
  </div>

  <!-- ðŸŽ® Ð­ÐºÑ€Ð°Ð½ Ð»Ð¾Ð±Ð±Ð¸ -->
  <div id="lobbyScreen" class="hidden text-center">
    <h1 class="text-5xl neon-text my-4">Ð›Ð¾Ð±Ð±Ð¸ ðŸ•’</h1>
    <p>ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²... ÐœÐ¸Ð½Ð¸Ð¼ÑƒÐ¼ 3 ðŸ‘¥</p>
    <p id="playerCount">Ð˜Ð³Ñ€Ð¾ÐºÐ¾Ð²: 0</p>
    <p id="countdown" class="text-2xl neon-text"></p>
    <canvas id="lobbyCanvas" width="800" height="600"></canvas>
  </div>

  <!-- ðŸƒ Ð­ÐºÑ€Ð°Ð½ Ð¸Ð³Ñ€Ñ‹ -->
  <div id="gameScreen" class="hidden text-center">
    <h1 class="text-5xl neon-text my-4">Blend Cubes ðŸŽ²</h1>
    <p>Ð–Ð¸Ð²Ñ‹Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²: <span id="aliveCount">0</span> ðŸ‘¥</p>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
  </div>

  <script>
    // ðŸŽ¨ Ð­Ð»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ DOM
    const loginScreen = document.getElementById('loginScreen');
    const lobbyScreen = document.getElementById('lobbyScreen');
    const gameScreen = document.getElementById('gameScreen');
    const nicknameInput = document.getElementById('nickname');
    const joinBtn = document.getElementById('joinBtn');
    const playerCount = document.getElementById('playerCount');
    const countdown = document.getElementById('countdown');
    const aliveCount = document.getElementById('aliveCount');
    const lobbyCanvas = document.getElementById('lobbyCanvas');
    const gameCanvas = document.getElementById('gameCanvas');
    const lobbyCtx = lobbyCanvas.getContext('2d');
    const gameCtx = gameCanvas.getContext('2d');

    // ðŸŒ WebSocket
    const ws = new WebSocket('ws://localhost:8080');
    let playerId = null;
    let nickname = '';
    let players = {};
    let gameState = 'login';
    let keys = {};

    // ðŸšª Ð’Ñ…Ð¾Ð´ Ð² Ð¸Ð³Ñ€Ñƒ
    joinBtn.addEventListener('click', () => {
      nickname = nicknameInput.value.trim();
      if (nickname) {
        ws.send(JSON.stringify({ type: 'join', nickname }));
        loginScreen.classList.add('hidden');
        lobbyScreen.classList.remove('hidden');
        gameState = 'lobby';
      }
    });

    // ðŸŽ¹ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ
    document.addEventListener('keydown', e => keys[e.key] = true);
    document.addEventListener('keyup', e => keys[e.key] = false);

    // ðŸ–±ï¸ ÐšÐ»Ð¸Ðº Ð¿Ð¾ ÐºÑƒÐ±Ð¸ÐºÑƒ
    gameCanvas.addEventListener('click  document.addEventListener('click', (e) => {
      if (gameState === 'game') {
        const rect = gameCanvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        for (const id in players) {
          if (id !== playerId && players[id].alive) {
            const dx = players[id].x - x;
            const dy = players[id].y - y;
            if (Math.hypot(dx, dy) < 20) {
              ws.send(JSON.stringify({ type: 'kill', targetId: id }));
              break;
            }
          }
        }
      }
    });

    // ðŸ“¡ ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð¾Ñ‚ ÑÐµÑ€Ð²ÐµÑ€Ð°
    ws.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      switch (msg.type) {
        case 'init':
          playerId = msg.playerId;
          break;
        case 'update':
          players = msg.players;
          if (gameState === 'lobby') {
            playerCount.textContent = `Ð˜Ð³Ñ€Ð¾ÐºÐ¾Ð²: ${Object.keys(players).length}`;
            countdown.textContent = msg.countdown ? `Ð¡Ñ‚Ð°Ñ€Ñ‚ Ñ‡ÐµÑ€ÐµÐ·: ${msg.countdown} ÑÐµÐº ðŸ•’` : '';
          } else if (gameState === 'game') {
            aliveCount.textContent = Object.values(players).filter(p => p.alive).length;
          }
          break;
        case 'start':
          lobbyScreen.classList.add('hidden');
          gameScreen.classList.remove('hidden');
          gameState = 'game';
          break;
      }
    };

    // ðŸŽ® ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð»Ð¾Ð±Ð±Ð¸
    function updateLobby() {
      lobbyCtx.clearRect(0, 0, lobbyCanvas.width, lobbyCanvas.height);
      for (const id in players) {
        const p = players[id];
        lobbyCtx.fillStyle = p.alive ? '#ff3399' : '#555';
        lobbyCtx.fillRect(p.x, p.y, 20, 20);
        lobbyCtx.fillStyle = 'white';
        lobbyCtx.font = '14px Arial';
        lobbyCtx.fillText(p.nickname, p.x, p.y - 10);
      }
      if (gameState === 'lobby') requestAnimationFrame(updateLobby);
    }

    // ðŸƒ ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð³Ñ€Ñ‹
    function updateGame() {
      gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);

      // ðŸŽ¥ ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»Ñ Ð·Ñ€ÐµÐ½Ð¸Ñ
      gameCtx.save();
      gameCtx.beginPath();
      gameCtx.arc(400, 300, 100, 0, Math.PI * 2);
      gameCtx.clip();

      // ðŸ—ºï¸ ÐžÑ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐ° ÐºÐ°Ñ€Ñ‚Ñ‹
      gameCtx.fillStyle = '#222';
      gameCtx.fillRect(0, 0, 1000, 1000);

      // ðŸŽ² ÐžÑ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐ° Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²
      for (const id in players) {
        const p = players[id];
        if (p.alive) {
          gameCtx.fillStyle = '#ff3399';
          gameCtx.fillRect(p.x - 10, p.y - 10, 20, 20);
          gameCtx.fillStyle = 'white';
          gameCtx.font = '14px Arial';
          gameCtx.fillText(p.nickname, p.x - 10, p.y - 20);
        }
      }

      gameCtx.restore();

      // ðŸš¶ Ð”Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ
      if (gameState === 'game' && players[playerId]?.alive) {
        let dx = 0, dy = 0;
        if (keys.ArrowUp || keys.w) dy -= 5;
        if (keys.ArrowDown || keys.s) dy += 5;
        if (keys.ArrowLeft || keys.a) dx -= 5;
        if (keys.ArrowRight || keys.d) dx += 5;
        if (dx || dy) {
          ws.send(JSON.stringify({ type: 'move', dx, dy }));
        }
      }

      if (gameState === 'game') requestAnimationFrame(updateGame);
    }

    // ðŸš€ Ð¡Ñ‚Ð°Ñ€Ñ‚ Ñ€ÐµÐ½Ð´ÐµÑ€Ð¸Ð½Ð³Ð°
    ws.onopen = () => {
      updateLobby();
    };
  </script>
</body>
</html>
